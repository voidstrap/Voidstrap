<ui:UiPage
    x:Class="Voidstrap.UI.Elements.Settings.Pages.NvidiaFastFlagsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Voidstrap.UI.Elements.Controls"
    xmlns:settings="clr-namespace:Voidstrap.UI.ViewModels.Settings"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:resources="clr-namespace:Voidstrap.Resources"
    xmlns:models="clr-namespace:Voidstrap.UI.ViewModels"
    Title="NVIDIA FastFlags"
    Scrollable="True">

    <StackPanel Margin="0,0,14,14">
        <TextBlock
            FontSize="14"
            Margin="0,0,0,8"
            TextWrapping="Wrap"
            Text="Configure NVIDIA driver FastFlags using a simplified, safe NIP-based interface." />

        <StackPanel>

            <ui:CardAction
            Click="OpenRawEditor_Click"
            Margin="0,8,0,0"
            Icon="Edit24">
                <StackPanel>
                    <TextBlock FontSize="14" Text="Advanced Editor" />
                    <TextBlock
                    Margin="0,2,0,0"
                    Padding="0,0,16,0"
                    FontSize="12"
                    Text="Open the raw NVIDIA Profile Inspector editor. Recommended for advanced users only." />
                </StackPanel>
            </ui:CardAction>

            <ui:CardAction
            Command="models:GlobalViewModel.OpenWebpageCommand"
            CommandParameter="https://discord.com/channels/1327967202015580223/1456965691054755911"
            Margin="0,8,0,0"
            Icon="Book24">
                <StackPanel>
                    <TextBlock FontSize="14" Text="NVIDIA Setup" />
                    <TextBlock
                    Margin="0,2,0,0"
                    Padding="0,0,16,0"
                    FontSize="12"
                    Text="Learn how to setup the NVIDIA FastFlags Editor." />
                </StackPanel>
            </ui:CardAction>

            <ui:CardAction
            Click="OpenFastFlagSettings_Click"
            Margin="0,8,0,0"
            Icon="Edit24">
                <StackPanel>
                    <TextBlock FontSize="14" Text="FastFlag Settings" />
                    <TextBlock
                    Margin="0,2,0,0"
                    Padding="0,0,16,0"
                    FontSize="12"
                    Text="{x:Static resources:Strings.Menu_FastFlags_Description}" />
                </StackPanel>
            </ui:CardAction>

            <controls:OptionControl
                    Header="Apply Changes" Foreground="{StaticResource TextFillColorTertiaryBrush}"
                    Description="Apply only the modified NVIDIA FastFlags to the driver.">
                <ui:Button
                        Content="Apply"
                        Icon="CheckmarkCircle24"
                        Click="Apply_Click"/>
            </controls:OptionControl>
        </StackPanel>
        

        <TextBlock Margin="0,16,0,0"
            FontSize="17.65"
            FontWeight="Medium"
            Text="FastFlags" />

        <ui:CardExpander Margin="0,8,0,0" IsExpanded="False">
            <ui:CardExpander.Header>
                <StackPanel>
                    <TextBlock FontSize="14" Text="Game Details" />
                    <TextBlock FontSize="12" Foreground="{StaticResource TextFillColorTertiaryBrush}"
                               Text="Image quality, frame pacing, and performance-related options." />
                </StackPanel>
            </ui:CardExpander.Header>

            <StackPanel>

                <controls:OptionControl
                    Header="Texture Quality (LOD Bias)"
                    Description="Lower values produce sharper textures. Higher values improve performance at the cost of detail.">
                    <StackPanel Width="220">
                        <Slider
                            Minimum="0"
                            Maximum="120"
                            TickFrequency="5"
                            IsSnapToTickEnabled="True"
                            Value="{Binding TextureLodBias, Mode=TwoWay}" />

                        <TextBlock
                            Margin="0,4,0,0"
                            FontSize="12"
                            Foreground="Gray"
                            Text="{Binding TextureLodBiasLabel}" />
                    </StackPanel>
                </controls:OptionControl>

                <controls:OptionControl
                    Header="MFAA"
                    Description="Improves anti-aliasing quality by combining MSAA samples across frames with minimal performance impact.">
                    <ui:ToggleSwitch IsChecked="{Binding EnableMFAA}" />
                </controls:OptionControl>

                <controls:OptionControl
    Header="FXAA"
    Description="Smooths jagged edges (jaggies) across the entire frame with minimal performance impact. FXAA can make edges and fine details appear slightly blurry.">
                    <ui:ToggleSwitch IsChecked="{Binding EnableFXAA}" />
                </controls:OptionControl>

                <controls:OptionControl
                    Header="Gamma Correction"
                    Description="Adjusts how brightness values are mapped, affecting contrast, shadow detail, and mid-tone visibility.">
                    <ui:ToggleSwitch IsChecked="{Binding EnableGamma}" />
                </controls:OptionControl>

                <controls:OptionControl
                    Header="Benchmark Overlay"
                    Description="Displays NVIDIA driver-level performance overlays such as FPS graphs and present timing data.">
                    <ComboBox
                        Width="220"
                        ItemsSource="{Binding BenchMarkOverlayModes}"
                        SelectedItem="{Binding BenchMarkOverlayMode}" />
                </controls:OptionControl>

                <controls:OptionControl
                    Header="Frame Rate Limiter"
                    Description="Limits the maximum frames per second using the NVIDIA driver. This does not uncap Roblox FPS use the FPS Unlocker on the Integrations page instead.">
                    <TextBox
                        Width="220"
                        Text="{Binding FrameRateLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </controls:OptionControl>

                <controls:OptionControl
    Header="Background Application Frame Rate Limit"
    Description="Limits the maximum frame rate when the application is running in the background to reduce GPU and CPU usage.">
                    <TextBox
        Width="220"
        Text="{Binding BackgroundFrameRateLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </controls:OptionControl>


            </StackPanel>
        </ui:CardExpander>

        <ui:CardExpander Margin="0,8,0,0">
            <ui:CardExpander.Header>
                <StackPanel>
                    <TextBlock FontSize="14" Text="Low Latency Modes" />
                    <TextBlock FontSize="12" Foreground="{StaticResource TextFillColorTertiaryBrush}"
                               Text="Controls how many frames are queued to reduce input latency." />
                </StackPanel>
            </ui:CardExpander.Header>

            <StackPanel>

                <controls:OptionControl
                    Header="CPL Low Latency Mode"
                    Description="Limits CPU-rendered frames queued by the NVIDIA Control Panel.">
                    <ComboBox
                        Width="220"
                        ItemsSource="{Binding CplLowLatencyModes}"
                        SelectedItem="{Binding SelectedCplLowLatencyMode}" />
                </controls:OptionControl>

                <controls:OptionControl
                    Header="FRL Low Latency Mode"
                    Description="Driver-level low latency control using Frame Rate Limiter logic.">
                    <ComboBox
                        Width="220"
                        ItemsSource="{Binding FrlLowLatencyModes}"
                        SelectedItem="{Binding SelectedFrlLowLatencyMode}" />
                </controls:OptionControl>

            </StackPanel>
        </ui:CardExpander>

        <ui:CardExpander Margin="0,8,0,0">
            <ui:CardExpander.Header>
                <StackPanel>
                    <TextBlock FontSize="14" Text="Hardware and Driver Overrides" />
                    <TextBlock FontSize="12" Foreground="{StaticResource TextFillColorTertiaryBrush}"
                               Text="Overrides that affect GPU behavior and driver features." />
                </StackPanel>
            </ui:CardExpander.Header>

            <StackPanel>

                <controls:OptionControl
                    Header="Resizable BAR"
                    Description="Allows the CPU to access the full GPU memory range on supported systems.">
                    <ui:ToggleSwitch IsChecked="{Binding EnableRbar}" />
                </controls:OptionControl>
                

                <controls:OptionControl
                    Header="SILK Smoothness"
                    Description="Controls NVIDIA SILK frame smoothing intensity.">
                    <ComboBox
                        Width="220"
                        ItemsSource="{Binding SilkSmoothnessModes}"
                        SelectedItem="{Binding SelectedSilkSmoothness}" />
                </controls:OptionControl>

            </StackPanel>
        </ui:CardExpander>

    </StackPanel>
</ui:UiPage>
